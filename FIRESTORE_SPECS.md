# Firestore docs

### **The structure of the data on Firestore**

The overall structure of the Firestore database is built so that it's scalable and usable for multi-user chat as well requiring as few concurrently open connections as possible taking into account the querying restrictions of the client SDKs.

There are two top level collections in Firestore:
* Conversations
* Users

#### Conversations

The `conversations` is the top level collection in firestore


`conversations`
* `id` - identifier of each document (generated by firestore e.g. DJf19Wcn9n5arVMvSHPu)
* `last_message` - container for the minimum necessary info about the
  last message - the structure same as a standard message
* `members` [] - an array of user's id who are members of this conversation
* `members_meta` [] - a map with `userId` as an identifier for partial user data
    * `name` - name of the user
* `seen` [] - a map with `userId` as an identifier saving the last message that was read
	* `message_id` - identifier of the last message read by the user
	* `timestamp` - timestamp of seeing the last message by the user
* `messages` - as a subcollection of the conversation that can be paged and queried independently

#### Messages

The `messages` is subcollection of `conversations` in firestore
`messages`
* `id` - identifier of each document (generated by firstore e.g. DJf19Wcn9n5arVMvSHPu)
* `sender_id` - id of the user who sent the message
* `timestamp` - a timestamp of the message defined as a firestore Timestamp
* `message_type` - *text* | *image* - type of the message, more types to be added in future
* `data`
  *  `message` - in case of a text message, the text of the message
  *  `image` - in case of an image message, this object contains image
     data
        *  `image_url` - url of the image

#### Users

The `users` is the top level collection in firestore This collection can
be used optionally but is in the default implementation of the SDK.
However it should be relatively easy to swap for a different external
data source (e.g. REST API of the client). It contains the minimum
necessary information about users that has to be shown for the chat.
Ideally the client app won't have a long lasting connection opened to
this collection, but will only refresh the users on a regular basis
(usually in the matter of hours) - this is to be implemented by the
client app.

`users`
* `id` - *String* user id independent of the auto-generated id for cases when these data has a source outside of Firestore
* `name` - name of the user
* `image_url` - image url of the user's profile picture